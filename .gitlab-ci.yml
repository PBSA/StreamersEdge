stages:
  - test
  - build

test:
  image: node:10.15-alpine
  stage: test
  variables:
    DB_USER: postgres
    DB_PASSWORD: ""
    DB_HOST: postgres
    DB_PORT: 5432
    DB_DATABASE: streamers-edge-test
    POSTGRES_DB: streamers-edge-test
    POSTGRES_USER: postgres
    POSTGRES_PASSWORD: ""
  services:
    - postgres:latest
  cache:
    key: $CI_COMMIT_REF_NAME
    paths:
      - node_modules
  script:
    - npm i
    - npm run test:audit
    - npm run test:lint
    - npm run test:coverage
  tags:
    - docker
  only:
    - merge_requests
    - develop
    - master
    - web
